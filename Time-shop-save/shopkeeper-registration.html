<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Shopkeeper Registration â€” Time Shop Save</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
  :root { --bg1:#070416; --g1:#7b2ff7; --g2:#ff6ec7; --g3:#2be7ff; --text:#eaf3ff; --muted:rgba(234,243,255,0.65); --accent:linear-gradient(90deg,var(--g1),var(--g2),var(--g3)); }
  *{box-sizing:border-box} body { margin:0; font-family:'Inter',sans-serif; background:var(--bg1); color:var(--text); display:flex; justify-content:center; align-items:center; min-height:100vh; }
  .card { width:92%; max-width:480px; background:rgba(255,255,255,0.04); border:1px solid rgba(255,255,255,0.08); border-radius:16px; padding:32px 28px; }
  form { display:flex; flex-direction:column; gap:13px; }
  input,select { padding:11px 13px; border-radius:8px; border:1px solid rgba(255,255,255,0.09); background:rgba(255,255,255,0.05); color:var(--text); }
  select option { background:#000; }
  button { background:var(--accent); color:#071126; font-weight:700; padding:13px; border:0; border-radius:10px; cursor:pointer; }
  .error { color:#ff4d4d; text-align:center; font-size:13px; display:none; }
  .success { color:#55ff99; text-align:center; font-size:13px; display:none; }
</style>
</head>
<body>
<div class="card">
  <h2 style="text-align:center;color:var(--text)">Shopkeeper Registration</h2>
  <form id="registerForm">
    <input id="regName" type="text" placeholder="Full name" required>
    <input id="regEmail" type="email" placeholder="Email" required>
    <input id="regPassword" type="password" placeholder="Password" required>
    <input id="regShop" type="text" placeholder="Shop name" required>
    <select id="regCategory" required>
      <option value="">Select shop category</option>
      <option value="Shop">Shop</option>
      <option value="Electronics">Electronics</option>
      <option value="Fashion">Fashion</option>
      <option value="Food">Food</option>
      <option value="Other">Other</option>
    </select>
    <button type="submit" id="registerBtn">Register Shop</button>
    <div id="formMsg" class="error"></div>
    <div id="formSuccess" class="success"></div>
    <div style="text-align:center;font-size:13px;margin-top:10px;color:var(--muted)">
      Already have an account? <a href="shopkeeper-login.html" style="color:var(--g3)">Login</a>
    </div>
  </form>
</div>

<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyCws2eOt3muKCpjHIxB3vUlOHGA06xLhtc",
  authDomain: "time-shop-save.firebaseapp.com",
  projectId: "time-shop-save",
  storageBucket: "time-shop-save.firebasestorage.app",
  messagingSenderId: "1037284454386",
  appId: "1:1037284454386:web:a863e690cc63049e1cc56b"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

document.getElementById('registerForm').addEventListener('submit', async (e) => {
  e.preventDefault();
  const msg = document.getElementById('formMsg');
  const success = document.getElementById('formSuccess');
  const btn = document.getElementById('registerBtn');
  
  msg.style.display = 'none';
  success.style.display = 'none';
  
  const email = document.getElementById('regEmail').value;
  const password = document.getElementById('regPassword').value;
  const name = document.getElementById('regName').value;
  const shopName = document.getElementById('regShop').value;
  const category = document.getElementById('regCategory').value;

  btn.textContent = "Registering...";
  btn.disabled = true;

  try {
    const cred = await auth.createUserWithEmailAndPassword(email, password);
    
    // Save to Firestore 'shopkeepers' collection
    await db.collection('shopkeepers').doc(cred.user.uid).set({
      name: name,
      email: email,
      shopName: shopName,
      category: category,
      role: 'shop',
      createdAt: new Date().toISOString()
    });

    // Set local storage for immediate dashboard access
    localStorage.setItem('rememberUser', email);
    localStorage.setItem('user:'+email, JSON.stringify({ name, email, shopName, category, role:'shop' }));

    success.textContent = "Success! Redirecting to dashboard...";
    success.style.display = 'block';
    
    setTimeout(() => window.location.href = 'shopkeeper.html', 1500);

  } catch (err) {
    console.error(err);
    msg.textContent = err.message;
    msg.style.display = 'block';
    btn.textContent = "Register Shop";
    btn.disabled = false;
  }
});
</script>
</body>
</html>