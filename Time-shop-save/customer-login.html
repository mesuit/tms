<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Customer Login — Time Shop Save</title>

<link rel="icon" type="image/svg+xml" href="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><defs><linearGradient id='g' x1='0' x2='1'><stop offset='0' stop-color='%237b2ff7'/><stop offset='1' stop-color='%23ff6ec7'/></linearGradient></defs><rect width='100' height='100' rx='16' fill='url(%23g)'/><text x='50' y='60' font-family='Inter,Arial,sans-serif' font-weight='800' font-size='28' text-anchor='middle' fill='%23070416'>TSS</text></svg>">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
:root { --bg1:#070416; --g1:#7b2ff7; --g2:#ff6ec7; --g3:#2be7ff; --text:#eaf3ff; --muted:rgba(234,243,255,0.65); --accent:linear-gradient(90deg,var(--g1),var(--g2),var(--g3)); }
*{box-sizing:border-box} body { margin:0; font-family:'Inter',sans-serif; background:var(--bg1); color:var(--text); display:flex; justify-content:center; align-items:center; height:100vh; }
.card { width:92%; max-width:440px; background:rgba(255,255,255,0.03); border:1px solid rgba(255,255,255,0.06); border-radius:14px; padding:24px 26px; box-shadow:0 8px 30px rgba(0,0,0,0.5); backdrop-filter:blur(10px); position:relative; }
.card h2 { text-align:center; font-size:20px; margin-bottom:14px; background:var(--accent); -webkit-background-clip:text; color:transparent; }
form { display:flex; flex-direction:column; gap:10px; }
input { padding:10px 12px; border-radius:8px; border:1px solid rgba(255,255,255,0.08); background:rgba(255,255,255,0.05); color:var(--text); font-size:14px; }
button { background:var(--accent); color:#071126; font-weight:700; padding:12px; border:0; border-radius:10px; cursor:pointer; }
.switch { text-align:center; font-size:13px; color:var(--muted); } .switch a {color:var(--g3);cursor:pointer;}
.back-btn { position:absolute; top:12px; left:12px; background:rgba(255,255,255,0.05); border:none; color:var(--text); border-radius:50%; width:36px; height:36px; font-size:18px; cursor:pointer; }
.hidden { display:none !important; }
.error { text-align:center; color:#ff4d4d; font-size:13px; margin-top:4px; }
.success { text-align:center; color:#55ff99; font-size:13px; margin-top:4px; }
</style>
</head>
<body>

<div class="card">
  <button class="back-btn" onclick="window.location.href='index.html'" title="Back">←</button>
  <h2 id="formTitle">Customer Login</h2>

  <form id="loginForm">
    <input id="loginEmail" type="email" placeholder="Email" required>
    <input id="loginPassword" type="password" placeholder="Password" required>
    <button type="submit" id="loginBtn">Login</button>
    <div id="loginMsg" class="error hidden"></div>
    <div class="switch"><a id="forgotPass">Forgot Password?</a></div>
    <div class="switch">Don’t have an account? <a href="customer-register.html">Register</a></div>
  </form>

  <form id="forgotForm" class="hidden">
    <h2 style="font-size:16px;margin:0 0 8px 0;text-align:center;">Reset Password</h2>
    <input id="resetEmail" type="email" placeholder="Enter your registered email" required>
    <button type="submit" id="resetBtn">Send Reset Link</button>
    <div id="resetMsg" class="error hidden"></div>
    <div id="resetSuccess" class="success hidden"></div>
    <div class="switch"><a id="backToLogin">Back to Login</a></div>
  </form>
</div>

<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyCws2eOt3muKCpjHIxB3vUlOHGA06xLhtc",
  authDomain: "time-shop-save.firebaseapp.com",
  projectId: "time-shop-save",
  storageBucket: "time-shop-save.firebasestorage.app",
  messagingSenderId: "1037284454386",
  appId: "1:1037284454386:web:a863e690cc63049e1cc56b"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

const loginForm = document.getElementById("loginForm");
const forgotForm = document.getElementById("forgotForm");
const forgotPass = document.getElementById("forgotPass");
const backToLogin = document.getElementById("backToLogin");
const loginMsg = document.getElementById("loginMsg");
const resetMsg = document.getElementById("resetMsg");
const resetSuccess = document.getElementById("resetSuccess");

function showError(msg) {
  loginMsg.textContent = msg;
  loginMsg.classList.remove("hidden");
}

// Toggle Forms
forgotPass.addEventListener("click", () => {
  loginForm.classList.add("hidden");
  forgotForm.classList.remove("hidden");
});
backToLogin.addEventListener("click", () => {
  forgotForm.classList.add("hidden");
  loginForm.classList.remove("hidden");
});

// LOGIN LOGIC
loginForm.addEventListener("submit", async e => {
  e.preventDefault();
  loginMsg.classList.add("hidden");
  const btn = document.getElementById("loginBtn");
  btn.textContent = "Logging in...";
  btn.disabled = true;

  const email = document.getElementById("loginEmail").value.trim();
  const password = document.getElementById("loginPassword").value;

  try {
    const cred = await auth.signInWithEmailAndPassword(email, password);
    
    // Set Local Storage for immediate access in other pages
    localStorage.setItem('rememberUser', email);
    localStorage.setItem('tss_last_login', email);
    
    // REDIRECT TO EXPLORE (Optimization)
    window.location.href = "explore.html";

  } catch (err) {
    console.error(err);
    if(err.code === "auth/user-not-found" || err.code === "auth/wrong-password") {
      showError("Invalid email or password.");
    } else {
      showError("Login failed: " + err.message);
    }
  }
  btn.textContent = "Login";
  btn.disabled = false;
});

// RESET PASSWORD LOGIC
document.getElementById("resetBtn").addEventListener("click", async (e) => {
  e.preventDefault();
  resetMsg.classList.add('hidden');
  resetSuccess.classList.add('hidden');
  
  const email = document.getElementById("resetEmail").value.trim();
  if(!email) return;

  try {
    await auth.sendPasswordResetEmail(email);
    resetSuccess.textContent = "Check your email for the reset link!";
    resetSuccess.classList.remove("hidden");
  } catch(err) {
    resetMsg.textContent = err.message;
    resetMsg.classList.remove("hidden");
  }
});
</script>
</body>
</html>