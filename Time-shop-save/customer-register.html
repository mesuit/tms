<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Customer Register — Time Shop Save</title>

<link rel="icon" type="image/svg+xml" href="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><defs><linearGradient id='g' x1='0' x2='1'><stop offset='0' stop-color='%237b2ff7'/><stop offset='1' stop-color='%23ff6ec7'/></linearGradient></defs><rect width='100' height='100' rx='16' fill='url(%23g)'/><text x='50' y='60' font-family='Inter,Arial,sans-serif' font-weight='800' font-size='28' text-anchor='middle' fill='%23070416'>TSS</text></svg>">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

<style>
:root { --bg1:#070416; --g1:#7b2ff7; --g2:#ff6ec7; --g3:#2be7ff; --text:#eaf3ff; --muted:rgba(234,243,255,0.65); --accent:linear-gradient(90deg,var(--g1),var(--g2),var(--g3)); }
*{box-sizing:border-box} body { margin:0; font-family:'Inter',sans-serif; background:var(--bg1); color:var(--text); display:flex; justify-content:center; align-items:center; height:100vh; }
.card { width:92%; max-width:440px; background:rgba(255,255,255,0.03); border:1px solid rgba(255,255,255,0.06); border-radius:14px; padding:24px 26px; box-shadow:0 8px 30px rgba(0,0,0,0.5); backdrop-filter:blur(10px); position:relative; }
.card h2 { text-align:center; font-size:20px; margin-bottom:14px; background:var(--accent); -webkit-background-clip:text; color:transparent; }
form { display:flex; flex-direction:column; gap:10px; }
input { padding:10px 12px; border-radius:8px; border:1px solid rgba(255,255,255,0.08); background:rgba(255,255,255,0.05); color:var(--text); font-size:14px; }
button { background:var(--accent); color:#071126; font-weight:700; padding:12px; border:0; border-radius:10px; cursor:pointer; }
.switch { text-align:center; font-size:13px; color:var(--muted); } .switch a {color:var(--g3);cursor:pointer;}
.back-btn { position:absolute; top:12px; left:12px; background:rgba(255,255,255,0.05); border:none; color:var(--text); border-radius:50%; width:36px; height:36px; font-size:18px; cursor:pointer; }
.hidden { display:none !important; }
.error { text-align:center; color:#ff4d4d; font-size:13px; margin-top:4px; }
.success { text-align:center; color:#55ff99; font-size:13px; margin-top:4px; }
</style>
</head>
<body>
<div class="bg"></div>

<div class="card">
  <button class="back-btn" onclick="window.location.href='customer-login.html'" title="Back">←</button>
  <h2>Customer Registration</h2>

  <form id="registerForm">
    <input id="fullName" type="text" placeholder="Full Name" required>
    <input id="email" type="email" placeholder="Email" required>
    <input id="phone" type="tel" placeholder="Phone Number" required>
    <input id="password" type="password" placeholder="Password" required>
    <button type="submit" id="registerBtn">Create Account</button>
    <div id="msg" class="error hidden"></div>
    <div id="success" class="success hidden"></div>
    <div class="switch">Already have an account? <a href="customer-login.html">Login</a></div>
  </form>
</div>

<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyCws2eOt3muKCpjHIxB3vUlOHGA06xLhtc",
  authDomain: "time-shop-save.firebaseapp.com",
  projectId: "time-shop-save",
  storageBucket: "time-shop-save.firebasestorage.app",
  messagingSenderId: "1037284454386",
  appId: "1:1037284454386:web:a863e690cc63049e1cc56b"
};

let firebaseAvailable = false;
try {
  if (typeof firebase !== 'undefined') {
    firebase.initializeApp(firebaseConfig);
    firebaseAvailable = !!firebase.auth();
  }
} catch (e) {
  console.warn('Firebase init skipped or failed:', e);
  firebaseAvailable = false;
}

// local registration helper
function saveLocalUser({ name, email, phone, password }) {
  const key = 'user:' + String(email).toLowerCase();
  const userObj = {
    id: 'local_' + Date.now(),
    name,
    email,
    phone,
    password,
    role: 'customer',
    createdAt: new Date().toISOString()
  };
  localStorage.setItem(key, JSON.stringify(userObj));
  localStorage.setItem('rememberUser', userObj.email);
  localStorage.setItem('tss_last_login', userObj.email);
  return userObj;
}

const form = document.getElementById("registerForm");
const msg = document.getElementById("msg");
const success = document.getElementById("success");
const btn = document.getElementById("registerBtn");

function showError(text){
  msg.textContent = text;
  msg.classList.remove('hidden');
  success.classList.add('hidden');
}
function showSuccess(text){
  success.textContent = text;
  success.classList.remove('hidden');
  msg.classList.add('hidden');
}

form.addEventListener("submit", async e => {
  e.preventDefault();
  msg.classList.add("hidden");
  success.classList.add("hidden");
  
  const name = document.getElementById("fullName").value.trim();
  const email = document.getElementById("email").value.trim().toLowerCase();
  const phone = document.getElementById("phone").value.trim();
  const password = document.getElementById("password").value;

  if (!name || !email || !phone || !password) {
    showError("Please fill all fields.");
    return;
  }

  btn.textContent = "Creating Account...";
  btn.disabled = true;

  // Firebase Cloud Registration
  if (firebaseAvailable) {
    try {
      const auth = firebase.auth();
      const db = firebase.firestore();
      
      const cred = await auth.createUserWithEmailAndPassword(email, password);
      const uid = cred.user.uid;
      
      await db.collection("users").doc(uid).set({
        name: name,
        email: email,
        phone: phone,
        role: "customer",
        dateRegistered: new Date().toISOString()
      });
      
      // Save local session for immediate speed
      localStorage.setItem('rememberUser', email);
      localStorage.setItem('tss_last_login', email);
      
      showSuccess("Registration successful! Redirecting to Explore...");
      
      // FIXED: Redirect to Explore
      setTimeout(() => window.location.href = "explore.html", 1500);
      return;

    } catch (err) {
      console.warn('Firebase registration failed:', err);
      if (err.code === "auth/email-already-in-use") {
        showError("This email is already registered. Try logging in.");
        btn.textContent = "Create Account";
        btn.disabled = false;
        return;
      }
      // If error is network related, fall through to local
    }
  }

  // Local fallback (Only if cloud fails)
  try {
    if (localStorage.getItem('user:' + email)) {
      showError("This email is already registered locally. Please login.");
      btn.textContent = "Create Account";
      btn.disabled = false;
      return;
    }
    saveLocalUser({ name, email, phone, password });
    showSuccess("Registration successful (local mode)! Redirecting...");
    
    // FIXED: Redirect to Explore
    setTimeout(() => window.location.href = "explore.html", 1000);
  } catch (err) {
    console.error(err);
    showError("Registration failed: " + (err.message || String(err)));
    btn.textContent = "Create Account";
    btn.disabled = false;
  }
});
</script>
</body>
</html>